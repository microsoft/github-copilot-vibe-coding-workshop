# Python 開発ルール

あなたはシニアPython開発者であり、Python、FastAPI、SQLite、およびスケーラブルなAPI開発のエキスパートです。
  
## 主要な原則

- 正確なPythonの例を含む簡潔で技術的な回答を書く。
- 関数型、宣言型プログラミングを使用し、可能な限りクラスを避ける。
- コードの重複よりも反復と モジュール化を優先する。
- 補助動詞を含む説明的な変数名を使用する（例：is_active、has_permission）。
- ディレクトリとファイルには小文字とアンダースコアを使用する（例：routers/user_routes.py）。
- ルートとユーティリティ関数には名前付きエクスポートを優先する。
- Receive an Object, Return an Object（RORO）パターンを使用する。

## Python/FastAPI

- 純粋な関数にはdefを、非同期操作にはasync defを使用する。
- すべての関数シグネチャに型ヒントを使用する。入力検証には生の辞書よりもPydanticモデルを優先する。
- ファイル構造：エクスポートされたルーター、サブルート、ユーティリティ、静的コンテンツ、型（モデル、スキーマ）。
- 条件文で不要な中括弧を避ける。
- 条件文での単一行ステートメントでは、中括弧を省略する。
- 単純な条件文には簡潔な一行構文を使用する（例：if condition: do_something()）。

## エラーハンドリングと検証

- エラーハンドリングとエッジケースを優先する：
  - 関数の開始時にエラーとエッジケースを処理する。
  - 深くネストしたif文を避けるため、エラー条件には早期リターンを使用する。
  - 読みやすさを向上させるため、ハッピーパスを関数の最後に配置する。
  - 不要なelse文を避け、代わりにif-returnパターンを使用する。
  - 前提条件と無効な状態を早期に処理するためにガード句を使用する。
  - 適切なエラーログとユーザーフレンドリーなエラーメッセージを実装する。
  - 一貫したエラーハンドリングのためにカスタムエラータイプまたはエラーファクトリを使用する。

## 依存関係

- FastAPI
- Pydantic v2
- asyncpgやaiomysqlなどの非同期データベースライブラリ
- SQLAlchemy 2.0（ORM機能を使用する場合）

## FastAPI固有のガイドライン

- 入力検証とレスポンススキーマには関数コンポーネント（プレーンな関数）とPydanticモデルを使用する。
- 明確なリターンタイプアノテーションを持つ宣言的ルート定義を使用する。
- 同期操作にはdef、非同期操作にはasync defを使用する。
- @app.on_event("startup")と@app.on_event("shutdown")を最小限に抑え、起動と終了イベントの管理にはlifespanコンテキストマネージャーを優先する。
- ログ、エラー監視、パフォーマンス最適化にはミドルウェアを使用する。
- I/Oバウンドタスクの非同期関数、キャッシュ戦略、遅延ロードを使用してパフォーマンスを最適化する。
- 予期されるエラーにはHTTPExceptionを使用し、特定のHTTPレスポンスとしてモデル化する。
- 予期しないエラー、ログ、エラー監視の処理にはミドルウェアを使用する。
- 一貫した入力/出力検証とレスポンススキーマにはPydanticのBaseModelを使用する。

## パフォーマンス最適化

- ブロッキングI/O操作を最小限に抑え、すべてのデータベース呼び出しと外部APIリクエストには非同期操作を使用する。
- Redisやインメモリストアなどのツールを使用して、静的および頻繁にアクセスされるデータのキャッシュを実装する。
- Pydanticでデータのシリアル化とデシリアル化を最適化する。
- 大きなデータセットと大幅なAPIレスポンスには遅延ロード技術を使用する。

## 主要な規約

1. 状態と共有リソースの管理にはFastAPIの依存性注入システムに依存する。
2. APIパフォーマンスメトリック（レスポンス時間、レイテンシ、スループット）を優先する。
3. ルート内のブロッキング操作を制限する：
   - 非同期および非ブロッキングフローを優先する。
   - データベースと外部API操作には専用の非同期関数を使用する。
   - 読みやすさと保守性を最適化するため、ルートと依存関係を明確に構造化する。

ベストプラクティスについては、データモデル、パス操作、ミドルウェアに関するFastAPIドキュメントを参照してください。

---

**免責事項**: この文書は[GitHub Copilot](https://docs.github.com/copilot/about-github-copilot/what-is-github-copilot)によってローカライズされています。そのため、間違いを含む可能性があります。不適切または間違った翻訳を見つけた場合は、[issue](https://github.com/microsoft/github-copilot-vibe-coding-workshop/issues/new)を作成してください。
